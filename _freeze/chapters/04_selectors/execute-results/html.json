{
  "hash": "17b7fbff5731a6c68075c41e0bb131e8",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Choose your column: selectors\"\nformat:\n    revealjs:\n        slide-number: true\n        toc: true\n        code-fold: false\n        code-tools: true\n\n---\n\n1. Better column control in Apply*, Select\n2. Overview of the selectors\n3. Combining selectors\n4. Custom filters \n\nVery often, column selection is more complex than simply passing a list of column\nnames to a transformer: it may be necessary to select all columns that have a\nspecific data type, or based on some other characteristic (presence of nulls,\ncolumn cardinality etc.).\n\nThe skrub `selectors` implement a number of selection strategies that can be \ncombined in various ways to build complex filtering conditions that can then be \nemployed by `ApplyToCols`, `ApplyToFrame`, `SelectCols` and `DropCols`. \n\n## Skrub selectors\nSelectors are available from the `skrub.selectors` namespace:\n\n::: {#1122f28a .cell execution_count=1}\n``` {.python .cell-code}\nimport skrub.selectors as s\n```\n:::\n\n\nSelectors allow to filter columns by data type:\n\n- `.float`: floating-point columns\n- `.integer`: integer columns\n- `.any_date`: date or datetime columns\n- `.boolean`: boolean columns\n- `.string`: columns with a String data type\n- `.categorical`: columns with a Categorical data type\n- `.numeric`: numeric (either integer or float) columns\n\nAdditional conditions include:\n\n- `.all`: select all columns\n- `.cardinality_below`: select all columns with a number of unique values lower\nthan the given `threshold`\n- `.has_nulls`: select all columns that include at least one null value\n\nVarious selectors allow to choose columns based on their name: \n\n- `.cols`: choose the provided column name (or list of names)\n- `.glob`: use Unix shell style `glob` to select column names\n- `.regex`: select columns using regular expressions\n\n## Combining selectors\n\nSelectors can be inverted using `.inv` or the logical operator `~` to\nselect all _other_ columns, and they can be combined using the `&` and `|`\nlogical operators. It is also possible to remove from a selection with `-`:\n\n## Designing custom filters\nFinally, it is possible to define function-based selectors using `.filter` and \n`.filter_names`. \n\n`.filter` selects columns for which the `predicate` evaluated by a user-defined\nfunction is `True`. \nFor example,  it is possible to select columns that include a certain amount of \nnulls by defining a function like the following:\n\n::: {#4c574f75 .cell execution_count=2}\n``` {.python .cell-code}\nimport pandas as pd\nimport skrub.selectors as s\nfrom skrub import DropCols\n\ndf = pd.DataFrame({\"a\": [None, None, None, 1], \"b\": [1,2,3,4]})\n\ndef more_nulls_than(col, threshold=.5):\n    return col.isnull().sum()/len(col) > threshold\n\nDropCols(cols=s.filter(more_nulls_than, threshold=0.5)).fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>b</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n`.filter_names` is similar to `.filter` in the sense that it takes a function that\nreturns a predicate, but in this case the function is evaluated over the column\nnames. \n\nIf we define this example dataframe:\n\n::: {#3fc08661 .cell execution_count=3}\n``` {.python .cell-code}\nfrom skrub import selectors as s\nimport pandas as pd\ndf = pd.DataFrame(\n    {\n        \"height_mm\": [297.0, 420.0],\n        \"width_mm\": [210.0, 297.0],\n        \"kind\": [\"A4\", \"A3\"],\n        \"ID\": [4, 3],\n    }\n)\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>height_mm</th>\n      <th>width_mm</th>\n      <th>kind</th>\n      <th>ID</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>297.0</td>\n      <td>210.0</td>\n      <td>A4</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>420.0</td>\n      <td>297.0</td>\n      <td>A3</td>\n      <td>3</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nWe can select all the columns that end with `\"_mm\"` as follows: \n\n::: {#9755a64c .cell execution_count=4}\n``` {.python .cell-code}\nselector = s.filter_names(lambda name: name.endswith('_mm'))\ns.select(df, selector)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>height_mm</th>\n      <th>width_mm</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>297.0</td>\n      <td>210.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>420.0</td>\n      <td>297.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Exercise: using selectors together with `ApplyToCols`\n\n1. define dataframe\n    - some numeric metrics \n    - a numerical id column\n    - a string id column\n    - some text column\n2. apply standardscaler to specific numerical columns, onehotencoder to specific (not all) string columns \n3. drop the id columns\n\n",
    "supporting": [
      "04_selectors_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}