{
  "hash": "c30d00d41ecf3d0d4be42b19aab894f5",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"All the pre-processing in one place: `TableVectorizer`\"\nformat:\n    revealjs:\n        slide-number: true\n        toc: true\n        code-fold: false\n        code-tools: true\n\n---\n\n1. List of transformations done by the TableVectorizer\n2. Specifying transformers\n3. Specific parameters\n    - Forwarded to the cleaner\n    - cardinality threshold\n4. `specific_transformers`\n\n\n## Exercise\nReplicate the behavior of a `TableVectorizer` using `ApplyToCols`, the skrub \nselectors, and the given transformers. \n\n::: {#9d7bf63c .cell execution_count=1}\n``` {.python .cell-code}\nfrom skrub import Cleaner, ApplyToCols, StringEncoder, DatetimeEncoder\nfrom sklearn.preprocessing import OneHotEncoder\nfrom sklearn.pipeline import make_pipeline\nimport skrub.selectors as s\n```\n:::\n\n\nNotes on the implementation: \n\n- In the first step, the TableVectorizer cleans the data to parse datetimes and other\ndtypes.\n- Numeric features are left untouched, i.e., they use a Passthrough transformer. \n- String and categorical feature are split into high and low cardinality features. \n- For this exercise, set the the cardinality `threshold` to 4. \n- High cardinality features are transformed with a `StringEncoder`. In this exercise,\nset `n_components` to 2. \n- Low cardinality features are transformed with a `OneHotEncoder`, and the first \ncategory in binary features is dropped (hint: check the docs of the `OneHotEncoder`\nfor the `drop` parameter). Set `sparse_output=True`.\n- Remember  `cardinality_below` is one of the skrub selectors. \n- Datetimes are transformed by a default `DatetimeEncoder`. \n- Everything should be wrapped in a scikit-learn `Pipeline`. \n\n\nUse the following dataframe to test the result. \n\n::: {#c4943803 .cell execution_count=2}\n``` {.python .cell-code}\nimport pandas as pd\nimport datetime\n\ndata = {\n    \"int\": [15, 56, 63, 12, 44],\n    \"float\": [5.2, 2.4, 6.2, 10.45, 9.0],\n    \"str1\": [\"public\", \"private\", \"private\", \"private\", \"public\"],\n    \"str2\": [\"officer\", \"manager\", \"lawyer\", \"chef\", \"teacher\"],\n    \"bool\": [True, False, True, False, True],\n    \"datetime-col\": [\n            \"2020-02-03T12:30:05\",\n            \"2021-03-15T00:37:15\",\n            \"2022-02-13T17:03:25\",\n            \"2023-05-22T08:45:55\",\n    ]\n    + [None],\n}\ndf = pd.DataFrame(data)\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>int</th>\n      <th>float</th>\n      <th>str1</th>\n      <th>str2</th>\n      <th>bool</th>\n      <th>datetime-col</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>15</td>\n      <td>5.20</td>\n      <td>public</td>\n      <td>officer</td>\n      <td>True</td>\n      <td>2020-02-03T12:30:05</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>56</td>\n      <td>2.40</td>\n      <td>private</td>\n      <td>manager</td>\n      <td>False</td>\n      <td>2021-03-15T00:37:15</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>63</td>\n      <td>6.20</td>\n      <td>private</td>\n      <td>lawyer</td>\n      <td>True</td>\n      <td>2022-02-13T17:03:25</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>12</td>\n      <td>10.45</td>\n      <td>private</td>\n      <td>chef</td>\n      <td>False</td>\n      <td>2023-05-22T08:45:55</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>44</td>\n      <td>9.00</td>\n      <td>public</td>\n      <td>teacher</td>\n      <td>True</td>\n      <td>None</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nUse the following `PassThrough` transformer where needed. \n\n::: {#513c58d4 .cell execution_count=3}\n``` {.python .cell-code}\nfrom skrub._apply_to_cols import SingleColumnTransformer\nclass PassThrough(SingleColumnTransformer):\n    def fit_transform(self, column, y=None):\n        return column\n\n    def transform(self, column):\n        return column\n```\n:::\n\n\n::: {#b18ae014 .cell execution_count=4}\n``` {.python .cell-code}\n# Write your code here\n#\n# \n# \n# \n# \n# \n# \n# \n# \n# \n# \n# \n```\n:::\n\n\n::: {#1a6eec97 .cell execution_count=5}\n``` {.python .cell-code}\ncleaner = ApplyToCols(Cleaner())\nhigh_cardinality = ApplyToCols(\n    StringEncoder(n_components=2), cols=~s.cardinality_below(4) & (s.string())\n)\nlow_cardinality = ApplyToCols(\n    OneHotEncoder(sparse_output=False, drop=\"if_binary\"),\n    cols=s.cardinality_below(4) & s.string(),\n)\nnumeric = ApplyToCols(PassThrough(), cols=s.numeric())\ndatetime = ApplyToCols(DatetimeEncoder(), cols=s.any_date())\n\nmy_table_vectorizer = make_pipeline(\n    cleaner, numeric, high_cardinality, low_cardinality, datetime\n)\n\nmy_table_vectorizer.fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>int</th>\n      <th>float</th>\n      <th>str1_public</th>\n      <th>str2_0</th>\n      <th>str2_1</th>\n      <th>bool_True</th>\n      <th>datetime-col_year</th>\n      <th>datetime-col_month</th>\n      <th>datetime-col_day</th>\n      <th>datetime-col_hour</th>\n      <th>datetime-col_total_seconds</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>15</td>\n      <td>5.20</td>\n      <td>1.0</td>\n      <td>0.820965</td>\n      <td>-0.926903</td>\n      <td>1.0</td>\n      <td>2020.0</td>\n      <td>2.0</td>\n      <td>3.0</td>\n      <td>12.0</td>\n      <td>1.580733e+09</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>56</td>\n      <td>2.40</td>\n      <td>0.0</td>\n      <td>0.820959</td>\n      <td>-0.926888</td>\n      <td>0.0</td>\n      <td>2021.0</td>\n      <td>3.0</td>\n      <td>15.0</td>\n      <td>0.0</td>\n      <td>1.615769e+09</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>63</td>\n      <td>6.20</td>\n      <td>0.0</td>\n      <td>0.862886</td>\n      <td>-0.936535</td>\n      <td>1.0</td>\n      <td>2022.0</td>\n      <td>2.0</td>\n      <td>13.0</td>\n      <td>17.0</td>\n      <td>1.644772e+09</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>12</td>\n      <td>10.45</td>\n      <td>0.0</td>\n      <td>1.029694</td>\n      <td>1.352996</td>\n      <td>0.0</td>\n      <td>2023.0</td>\n      <td>5.0</td>\n      <td>22.0</td>\n      <td>8.0</td>\n      <td>1.684745e+09</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>44</td>\n      <td>9.00</td>\n      <td>1.0</td>\n      <td>1.419121</td>\n      <td>0.660158</td>\n      <td>1.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#5db30071 .cell execution_count=6}\n``` {.python .cell-code}\nfrom skrub import TableVectorizer\n\ntv = TableVectorizer(\n    high_cardinality=StringEncoder(n_components=2), cardinality_threshold=4\n)\ntv.fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>int</th>\n      <th>float</th>\n      <th>str1_public</th>\n      <th>str2_0</th>\n      <th>str2_1</th>\n      <th>bool</th>\n      <th>datetime-col_year</th>\n      <th>datetime-col_month</th>\n      <th>datetime-col_day</th>\n      <th>datetime-col_hour</th>\n      <th>datetime-col_total_seconds</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>15.0</td>\n      <td>5.20</td>\n      <td>1.0</td>\n      <td>0.820970</td>\n      <td>-0.926893</td>\n      <td>1.0</td>\n      <td>2020.0</td>\n      <td>2.0</td>\n      <td>3.0</td>\n      <td>12.0</td>\n      <td>1.580733e+09</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>56.0</td>\n      <td>2.40</td>\n      <td>0.0</td>\n      <td>0.820966</td>\n      <td>-0.926890</td>\n      <td>0.0</td>\n      <td>2021.0</td>\n      <td>3.0</td>\n      <td>15.0</td>\n      <td>0.0</td>\n      <td>1.615769e+09</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>63.0</td>\n      <td>6.20</td>\n      <td>0.0</td>\n      <td>0.862891</td>\n      <td>-0.936528</td>\n      <td>1.0</td>\n      <td>2022.0</td>\n      <td>2.0</td>\n      <td>13.0</td>\n      <td>17.0</td>\n      <td>1.644772e+09</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>12.0</td>\n      <td>10.45</td>\n      <td>0.0</td>\n      <td>1.029687</td>\n      <td>1.353006</td>\n      <td>0.0</td>\n      <td>2023.0</td>\n      <td>5.0</td>\n      <td>22.0</td>\n      <td>8.0</td>\n      <td>1.684745e+09</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>44.0</td>\n      <td>9.00</td>\n      <td>1.0</td>\n      <td>1.419119</td>\n      <td>0.660159</td>\n      <td>1.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "08_feat_eng_table_vect_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}