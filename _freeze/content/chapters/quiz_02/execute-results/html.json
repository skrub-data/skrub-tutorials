{
  "hash": "9d677c97524938d9b6b45e0cf70b1299",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Quiz: Column-level transformations\"\nformat:\n    revealjs:\n        slide-number: true\n        toc: true\n        code-fold: false\n        code-tools: true\n\n---\n\n# Column transformers\n## Question 1\n\n::: {.callout}\nConsider this diagram. Which column transformer can replicate this behavior if \nit wraps a `OneHotEncoder`? \n\n![](images/ex_ApplyToCols.png)\n\n- [ ] A) `ApplyToCols`\n- [ ] B) `ApplyToFrame`\n- [ ] C) `DropCols`\n- [ ] D) `SelectCols`\n\n:::\n\n::: {.callout-tip collapse=\"true\"}\n### Solution\nAnswer: A)\n`ApplyToCols` takes a transformer, then clones it and applies it separately to \neach column under selection (in this case, `Name` and `Desc`). Columns that were\nnot selected are left unchanged. \n:::\n\n\n## Question 2\n\n::: {.callout}\nConsider this diagram. Which column transformer can replicate this behavior if \nit wraps a `PCA`? \n\n![](images/ex_ApplyToFrame.png)\n\n- [ ] A) `ApplyToCols`\n- [ ] B) `ApplyToFrame`\n- [ ] C) `DropCols`\n- [ ] D) `SelectCols`\n\n:::\n\n::: {.callout-tip collapse=\"true\"}\n### Solution\nAnswer: B)\n`ApplyToFrame` takes a transformer and a list of columns (usually, a subset of \nthe columns in the dataframe), then applies the transformer to all the selected\ncolumns at once, replacing them with the output of the transfromer. Columns that\nwere not selected are left unchanged. \n:::\n\n## Question 3\n\n::: {.callout}\nIs the following statement true or false?\n\n> The output of these two snippets is the same: \n\n```{.python}\nencode = ApplyToCols(OneHotEncoder(sparse_output=False), cols=s.string())\nscale = ApplyToCols(StandardScaler(), cols=s.numeric())\n```\n```{.python}\ncase_1 = make_pipeline(encode, scale)\ncase_1.fit_transform(df)\n```\n\n```{.python}\ncase_2 = make_pipeline(scale, encode)\ncase_2.fit_transform(df)\n```\n:::\n\n::: {.callout-tip collapse=\"true\"}\n### Solution\nAnswer: False. \n\nThe order of the operations matters, and a different order leads to different \nresults.\n\n::: {#05f3cb23 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nfrom sklearn.pipeline import make_pipeline\nfrom skrub import SelectCols, ApplyToCols, ApplyToFrame\nfrom sklearn.preprocessing import OneHotEncoder, StandardScaler\nimport skrub.selectors as s \n\nn_patients = 5\ndf = pd.DataFrame(\n    {\n        \"patient_id\": [f\"P{i:03d}\" for i in range(n_patients)],\n        \"age\": np.random.randint(18, 80, size=n_patients),\n        \"sex\": np.random.choice([\"M\", \"F\"], size=n_patients),\n    }\n)\nencode = ApplyToCols(OneHotEncoder(sparse_output=False), cols=s.string())\nscale = ApplyToCols(StandardScaler(), cols=s.numeric())\n```\n:::\n\n\n::: {#9cd6a41d .cell execution_count=2}\n``` {.python .cell-code}\ncase_1 = make_pipeline(encode, scale)\ndf_1 = case_1.fit_transform(df)\ndf_1\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>patient_id_P000</th>\n      <th>patient_id_P001</th>\n      <th>patient_id_P002</th>\n      <th>patient_id_P003</th>\n      <th>patient_id_P004</th>\n      <th>age</th>\n      <th>sex_F</th>\n      <th>sex_M</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2.0</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>-0.851943</td>\n      <td>-0.5</td>\n      <td>0.5</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-0.5</td>\n      <td>2.0</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>1.363108</td>\n      <td>-0.5</td>\n      <td>0.5</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>2.0</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>0.738350</td>\n      <td>-0.5</td>\n      <td>0.5</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>2.0</td>\n      <td>-0.5</td>\n      <td>-1.363108</td>\n      <td>2.0</td>\n      <td>-2.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>-0.5</td>\n      <td>2.0</td>\n      <td>0.113592</td>\n      <td>-0.5</td>\n      <td>0.5</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#8cefc0c3 .cell execution_count=3}\n``` {.python .cell-code}\ncase_2 = make_pipeline(scale, encode)\ndf_2 = case_2.fit_transform(df)\ndf_2\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>patient_id_P000</th>\n      <th>patient_id_P001</th>\n      <th>patient_id_P002</th>\n      <th>patient_id_P003</th>\n      <th>patient_id_P004</th>\n      <th>age</th>\n      <th>sex_F</th>\n      <th>sex_M</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-0.851943</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.363108</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.738350</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>-1.363108</td>\n      <td>1.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.113592</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n\n# Selectors\nFor the following questions, refer to this example dataframe: \n\n::: {#d9e97b37 .cell execution_count=4}\n``` {.python .cell-code}\nimport pandas as pd\nimport datetime\n\ndata = {\n    \"age\": [25, 34, 29, 42, 31],\n    \"salary\": [45000.0, 52000.0, 61000.0, None, 48000.0],\n    \"employment_type\": [\"full-time\", \"part-time\", None, \"contract\", \"full-time\"],\n    \"job_title\": [\"engineer\", \"analyst\", \"consultant\", \"designer\", \"developer\"],\n    \"department_title\": [\"IT\", \"Finance\", \"Consulting\", \"Design\", \"Development\"],\n    \"is_remote\": [False, True, False, True, False],\n    \"performance_rating\": pd.Categorical([\"excellent\", None, \"good\", \"excellent\", \"average\"]),\n    \"bonus_category\": pd.Categorical([\"5K+\", \"10K+\", \"15K+\", \"7K+\", \"12K+\"]),\n    \"hire_date\": [\n        datetime.datetime.fromisoformat(dt)\n        for dt in [\n            \"2018-06-01T09:00:00\",\n            \"2019-09-15T14:30:00\",\n            \"2020-11-20T10:15:00\",\n            \"2021-04-10T16:45:00\",\n        ]\n    ]\n    + [None],\n\n}\ndf = pd.DataFrame(data)\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>age</th>\n      <th>salary</th>\n      <th>employment_type</th>\n      <th>job_title</th>\n      <th>department_title</th>\n      <th>is_remote</th>\n      <th>performance_rating</th>\n      <th>bonus_category</th>\n      <th>hire_date</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>25</td>\n      <td>45000.0</td>\n      <td>full-time</td>\n      <td>engineer</td>\n      <td>IT</td>\n      <td>False</td>\n      <td>excellent</td>\n      <td>5K+</td>\n      <td>2018-06-01 09:00:00</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>34</td>\n      <td>52000.0</td>\n      <td>part-time</td>\n      <td>analyst</td>\n      <td>Finance</td>\n      <td>True</td>\n      <td>NaN</td>\n      <td>10K+</td>\n      <td>2019-09-15 14:30:00</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>29</td>\n      <td>61000.0</td>\n      <td>None</td>\n      <td>consultant</td>\n      <td>Consulting</td>\n      <td>False</td>\n      <td>good</td>\n      <td>15K+</td>\n      <td>2020-11-20 10:15:00</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>42</td>\n      <td>NaN</td>\n      <td>contract</td>\n      <td>designer</td>\n      <td>Design</td>\n      <td>True</td>\n      <td>excellent</td>\n      <td>7K+</td>\n      <td>2021-04-10 16:45:00</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>31</td>\n      <td>48000.0</td>\n      <td>full-time</td>\n      <td>developer</td>\n      <td>Development</td>\n      <td>False</td>\n      <td>average</td>\n      <td>12K+</td>\n      <td>NaT</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n## Question 4\n\n::: {.callout}\nWhat does this selector do? \n\n::: {#b0b56b4d .cell execution_count=5}\n``` {.python .cell-code}\nfrom skrub import SelectCols\nimport skrub.selectors as s\n\ndef fun(col):\n    mean = col.mean()\n    return mean > 40000\n\nsel = s.numeric() & s.filter(fun) \nt = SelectCols(cols=sel)\nt.fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>salary</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>45000.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>52000.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>61000.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>48000.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n- [ ] A) It drops only numerical columns with mean < 40000\n- [ ] B) It selects only numerical column with mean > 40000\n- [ ] C) It selects non-numeric columns or numeric columns that have mean > 40000\n- [ ] D) It drops only numeric columns unless their mean is < 40000\n\n\n:::\n\n::: {.callout-tip collapse=\"true\"}\n### Solution\nAnswer: B)\n\n::: {#027d6e92 .cell execution_count=6}\n``` {.python .cell-code}\nt.fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>salary</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>45000.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>52000.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>61000.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>48000.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n\n## Question 5\n\n::: {.callout}\nWhat does this selector do? \n\n::: {#aacc804e .cell execution_count=7}\n``` {.python .cell-code}\nsel = s.cols(\"salary\") | s.filter_names(lambda name: name.endswith(\"_title\"))\n\nt = SelectCols(cols=sel)\nt.fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>salary</th>\n      <th>job_title</th>\n      <th>department_title</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>45000.0</td>\n      <td>engineer</td>\n      <td>IT</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>52000.0</td>\n      <td>analyst</td>\n      <td>Finance</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>61000.0</td>\n      <td>consultant</td>\n      <td>Consulting</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>NaN</td>\n      <td>designer</td>\n      <td>Design</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>48000.0</td>\n      <td>developer</td>\n      <td>Development</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n- [ ] A) It selects the column \"salary\", numerical columns, and columns that end in \"_title\" \n- [ ] B) It drops all columns (including \"salary\"), except the columns that \nend in \"_title\"\n- [ ] C) It selects the column \"salary\", and columns whose name end in \"_title\"\n- [ ] D) It drops the column \"salary\", and columns whose name end in \"_title\"\n\n:::\n\n::: {.callout-tip collapse=\"true\"}\n### Solution\nAnswer: C)\n\n::: {#0f331a62 .cell execution_count=8}\n``` {.python .cell-code}\nt.fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>salary</th>\n      <th>job_title</th>\n      <th>department_title</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>45000.0</td>\n      <td>engineer</td>\n      <td>IT</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>52000.0</td>\n      <td>analyst</td>\n      <td>Finance</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>61000.0</td>\n      <td>consultant</td>\n      <td>Consulting</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>NaN</td>\n      <td>designer</td>\n      <td>Design</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>48000.0</td>\n      <td>developer</td>\n      <td>Development</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n\n## Question 6\n\n::: {.callout}\n\n::: {#c8eaff34 .cell execution_count=9}\n``` {.python .cell-code}\nfrom skrub import DropCols\nimport skrub.selectors as s\n\nsel = (s.string() | s.categorical()) & (s.has_nulls() | ~s.cardinality_below(4))\nt = DropCols(cols=sel)\n```\n:::\n\n\n- [ ] A) It drops string and categorical columns that contain nulls and have cardinality above 4 \n- [ ] B) It selects string and categorical columns that contain nulls and have cardinality below 4 \n- [ ] C) It drops string and categorical columns that contain nulls or have cardinality above 4 \n- [ ] D) It selects string and categorical columns that contain nulls and have cardinality below 4 \n:::\n\n::: {.callout-tip collapse=\"true\"}\n### Solution\nAnswer: C)\n\n::: {#2d39039d .cell execution_count=10}\n``` {.python .cell-code}\nt.fit_transform(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>age</th>\n      <th>salary</th>\n      <th>is_remote</th>\n      <th>hire_date</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>25</td>\n      <td>45000.0</td>\n      <td>False</td>\n      <td>2018-06-01 09:00:00</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>34</td>\n      <td>52000.0</td>\n      <td>True</td>\n      <td>2019-09-15 14:30:00</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>29</td>\n      <td>61000.0</td>\n      <td>False</td>\n      <td>2020-11-20 10:15:00</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>42</td>\n      <td>NaN</td>\n      <td>True</td>\n      <td>2021-04-10 16:45:00</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>31</td>\n      <td>48000.0</td>\n      <td>False</td>\n      <td>NaT</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n\n",
    "supporting": [
      "quiz_02_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}